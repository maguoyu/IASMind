# n8n 工作流执行 - 测试场景

## 测试准备

### 前置条件

1. ✅ n8n 服务正常运行
2. ✅ 已配置 `N8N_API_URL` 和 `N8N_API_KEY`
3. ✅ 已配置 `N8N_WEBHOOK_URL`
4. ✅ 至少有一个测试工作流

### 测试环境

- **前端**：http://localhost:3000/n8n
- **后端 API**：http://localhost:8000/api/n8n
- **n8n 服务**：http://localhost:5678

## 测试场景

### 场景 1：基本参数执行（API 方式）

**目标**：验证基本的参数传递和结果显示

**步骤**：
1. 打开 n8n 管理页面
2. 点击任意工作流的 "执行" 按钮
3. **不填写** Webhook 路径（留空）
4. 输入简单参数：
   ```json
   {
     "message": "测试消息"
   }
   ```
5. 点击 "提交执行"

**预期结果**：
- ✅ 对话框显示 "执行中" 徽章
- ✅ 显示加载动画
- ✅ 执行完成后显示 "执行成功" 徽章
- ✅ 结果区域显示 JSON 格式的返回数据
- ✅ "复制结果" 和 "重新执行" 按钮可用

**验证点**：
- [ ] 状态徽章正确显示
- [ ] 加载动画正常
- [ ] 结果格式化正确
- [ ] 复制功能正常
- [ ] 重新执行功能正常

---

### 场景 2：Webhook 方式执行

**目标**：验证 Webhook 路径自动提取和执行

**步骤**：
1. 选择一个包含 Webhook 节点的工作流
2. 点击 "执行" 按钮
3. 观察 Webhook 路径输入框的 placeholder
4. 点击 "使用工作流路径" 按钮
5. 输入参数：
   ```json
   {
     "topic": "笑话",
     "count": 3
   }
   ```
6. 点击 "提交执行"

**预期结果**：
- ✅ Webhook 路径自动显示在 placeholder 中
- ✅ 点击按钮后路径填充到输入框
- ✅ 显示绿色提示 "将使用 Webhook 方式执行"
- ✅ 执行成功后显示 webhook 返回的结果

**验证点**：
- [ ] 路径自动提取正确
- [ ] 一键填充功能正常
- [ ] Webhook 执行成功
- [ ] 返回结果正确显示

---

### 场景 3：JSON 格式验证

**目标**：验证实时 JSON 格式验证功能

**步骤**：
1. 打开执行对话框
2. 输入错误的 JSON：
   ```
   {message: "test"}
   ```
3. 观察错误提示
4. 修正为正确格式：
   ```json
   {"message": "test"}
   ```
5. 观察成功提示

**预期结果**：
- ✅ 错误 JSON 显示红色错误提示
- ✅ 错误信息清晰易懂
- ✅ 正确 JSON 显示绿色成功提示
- ✅ "提交执行" 按钮在错误时被禁用

**验证点**：
- [ ] 实时验证正常工作
- [ ] 错误提示准确
- [ ] 按钮状态正确
- [ ] 视觉反馈明确

---

### 场景 4：参数模板和示例

**目标**：验证快速填充功能

**步骤**：
1. 打开执行对话框
2. 点击 "使用模板" 按钮
3. 观察参数输入框内容
4. 清空输入框
5. 点击 "简单消息" 示例
6. 观察参数输入框内容
7. 点击 "用户数据处理" 示例
8. 观察参数输入框内容

**预期结果**：
- ✅ 每次点击都正确填充对应的 JSON
- ✅ JSON 格式正确（带缩进）
- ✅ 无格式错误提示
- ✅ 可以直接执行

**验证点**：
- [ ] 模板按钮正常
- [ ] 示例按钮正常
- [ ] JSON 格式正确
- [ ] 多次点击正常替换

---

### 场景 5：执行失败处理

**目标**：验证错误处理和重试功能

**步骤**：
1. 故意配置错误的参数或 Webhook 路径
2. 提交执行
3. 等待执行失败
4. 观察错误信息
5. 点击 "重新配置参数" 按钮
6. 修正参数
7. 再次提交执行

**预期结果**：
- ✅ 显示 "执行失败" 徽章
- ✅ 显示详细错误信息
- ✅ 提供重试选项
- ✅ 重试后回到配置界面
- ✅ 之前的参数被保留

**验证点**：
- [ ] 错误捕获正确
- [ ] 错误信息显示清晰
- [ ] 重试功能正常
- [ ] 参数保留正确

---

### 场景 6：长结果滚动

**目标**：验证长结果的显示和滚动

**步骤**：
1. 执行一个返回大量数据的工作流
2. 观察结果显示区域
3. 尝试滚动查看完整结果
4. 点击 "复制结果" 按钮
5. 粘贴到文本编辑器验证

**预期结果**：
- ✅ 结果区域最大高度 400px
- ✅ 超出部分显示滚动条
- ✅ 滚动流畅
- ✅ JSON 格式保持完整
- ✅ 复制的内容完整

**验证点**：
- [ ] 滚动区域正常
- [ ] 格式不错乱
- [ ] 复制完整
- [ ] 性能良好

---

### 场景 7：执行中状态

**目标**：验证执行中的 UI 状态

**步骤**：
1. 执行一个耗时较长的工作流
2. 在执行过程中：
   - 尝试修改参数
   - 尝试点击取消按钮
   - 尝试点击提交执行按钮
   - 尝试关闭对话框

**预期结果**：
- ✅ 所有输入框被禁用
- ✅ "取消" 按钮被禁用
- ✅ "提交执行" 按钮显示 "执行中..." 并被禁用
- ✅ 显示旋转的加载动画
- ✅ 不能关闭对话框（或有确认提示）

**验证点**：
- [ ] 输入框禁用
- [ ] 按钮状态正确
- [ ] 加载动画显示
- [ ] 防止重复提交

---

### 场景 8：多次执行

**目标**：验证重复执行功能

**步骤**：
1. 执行一个工作流
2. 等待执行成功
3. 点击 "重新执行" 按钮
4. 修改参数
5. 再次提交执行
6. 重复 2-5 步骤 3 次

**预期结果**：
- ✅ 每次执行都正常
- ✅ 结果正确更新
- ✅ 状态转换流畅
- ✅ 无内存泄漏或性能问题

**验证点**：
- [ ] 重复执行正常
- [ ] 状态重置正确
- [ ] 结果更新正确
- [ ] 性能稳定

---

### 场景 9：关闭和重新打开

**目标**：验证对话框状态重置

**步骤**：
1. 打开执行对话框
2. 配置参数
3. 执行工作流
4. 等待执行成功
5. 点击 "关闭" 按钮
6. 重新打开执行对话框
7. 观察初始状态

**预期结果**：
- ✅ 对话框恢复到初始状态
- ✅ 参数被清空（或恢复默认）
- ✅ 执行结果被清除
- ✅ 状态回到 idle
- ✅ 无之前的错误提示

**验证点**：
- [ ] 状态完全重置
- [ ] 参数清空
- [ ] 结果清除
- [ ] 无残留状态

---

### 场景 10：Webhook 路径验证

**目标**：验证 Webhook 路径格式验证

**步骤**：
1. 打开执行对话框
2. 输入错误的路径（不以 / 开头）：
   ```
   webhook-test/example
   ```
3. 观察错误提示
4. 修正路径：
   ```
   /webhook-test/example
   ```
5. 观察成功提示

**预期结果**：
- ✅ 错误路径显示红色错误提示
- ✅ 错误信息："Webhook 路径必须以 / 开头"
- ✅ 正确路径显示绿色成功提示
- ✅ 提交执行按钮状态正确

**验证点**：
- [ ] 路径验证正常
- [ ] 错误提示准确
- [ ] 按钮状态正确
- [ ] 视觉反馈清晰

---

## 性能测试

### 测试 1：大型 JSON 显示

**数据量**：10KB - 100KB JSON

**验证点**：
- [ ] 格式化速度
- [ ] 滚动性能
- [ ] 复制速度
- [ ] 内存占用

### 测试 2：快速连续执行

**次数**：10 次连续执行

**验证点**：
- [ ] 无请求积压
- [ ] 状态更新及时
- [ ] 无 UI 卡顿
- [ ] 无内存泄漏

---

## 兼容性测试

### 浏览器兼容

- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)

### 屏幕尺寸

- [ ] 桌面 (1920x1080)
- [ ] 笔记本 (1366x768)
- [ ] 小屏幕 (1280x720)

---

## 回归测试清单

每次修改后必须验证：

- [ ] 参数配置正常
- [ ] JSON 验证正常
- [ ] Webhook 路径提取正常
- [ ] 执行流程正常
- [ ] 结果显示正常
- [ ] 错误处理正常
- [ ] 重试功能正常
- [ ] 复制功能正常
- [ ] 状态重置正常
- [ ] 无 linter 错误
- [ ] 无 console 错误

---

## 已知问题

*(当前无已知问题)*

---

## 测试记录模板

```markdown
### 测试日期：2025-XX-XX
### 测试人员：XXX
### 版本：vX.X.X

| 场景 | 状态 | 备注 |
|-----|------|------|
| 场景 1 | ✅/❌ | |
| 场景 2 | ✅/❌ | |
| ... | ... | |

### 发现的问题：
1. ...
2. ...

### 建议改进：
1. ...
2. ...
```

---

## 总结

以上测试场景覆盖了：

- ✅ 基本功能验证
- ✅ 错误处理验证
- ✅ 用户体验验证
- ✅ 性能验证
- ✅ 兼容性验证

确保工作流执行功能稳定可靠！

