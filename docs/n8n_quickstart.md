# n8n 集成快速启动指南

## 5 分钟快速开始

### 1️⃣ 配置环境变量

在项目根目录编辑 `.env` 文件：

```bash
# n8n 工作流配置
N8N_API_URL=http://172.20.0.113:15678/api/v1
N8N_API_KEY=你的_n8n_api_密钥
```

### 2️⃣ 获取 n8n API 密钥

1. 打开 n8n 管理界面：http://172.20.0.113:15678
2. 登录后进入 **Settings** → **API**
3. 点击 **Create API Key**
4. 复制密钥并粘贴到 `.env` 文件中

### 3️⃣ 启动后端服务

```bash
# 在项目根目录
python server.py --host 0.0.0.0 --port 8000
```

### 4️⃣ 启动前端服务

```bash
# 在 web 目录
cd web
pnpm install  # 首次运行需要
pnpm dev
```

### 5️⃣ 访问页面

打开浏览器访问：**http://localhost:3000/n8n**

## 测试集成

运行测试脚本验证配置：

```bash
python scripts/test_n8n_integration.py
```

期望输出：
```
============================================================
n8n 集成测试
============================================================

📋 环境配置:
   N8N_API_URL: http://172.20.0.113:15678/api/v1
   N8N_API_KEY: 已配置

🔍 测试 n8n 健康检查...
   API URL: http://172.20.0.113:15678/api/v1
   API Key: ********xxx
✅ n8n API 连接成功

🔍 测试获取工作流列表...
✅ 成功获取 X 个工作流
   1. 工作流名称 (ID: xxx, 激活: True)
   ...

🔍 测试后端代理 API...
✅ 后端 API 健康检查成功
   状态: healthy
   API URL: http://172.20.0.113:15678/api/v1
   API Key 已配置: True
✅ 后端 API 成功获取 X 个工作流

============================================================
测试总结
============================================================
✅ 通过: 3/3
❌ 失败: 0/3

🎉 所有测试通过！n8n 集成工作正常。
```

## 功能预览

### 工作流管理
- 查看所有工作流
- 激活/停用工作流
- 手动执行工作流
- 删除工作流

### 执行记录
- 查看所有执行历史
- 按状态筛选（成功/失败/运行中）
- 查看执行详情和数据

### 健康监控
- n8n 服务状态实时显示
- API 连接状态检查

## 常见问题

### 问题 1: 404 错误 `/api/api/n8n`

**原因**: 环境变量配置重复了 `/api` 路径

**解决**:
- 确保 `NEXT_PUBLIC_API_URL` 不包含 `/api` 后缀
- 正确配置：`NEXT_PUBLIC_API_URL=http://localhost:8000`
- 错误配置：`NEXT_PUBLIC_API_URL=http://localhost:8000/api` ❌

### 问题 2: 连接超时

**原因**: n8n 服务未启动或网络不通

**解决**:
1. 检查 n8n 是否运行：访问 http://172.20.0.113:15678
2. 检查防火墙设置
3. 确认 IP 地址和端口正确

### 问题 3: 401 认证错误

**原因**: API 密钥错误或过期

**解决**:
1. 在 n8n 中重新生成 API 密钥
2. 更新 `.env` 文件中的 `N8N_API_KEY`
3. 重启后端服务

## 下一步

- 📖 阅读完整文档：[n8n_integration_guide.md](./n8n_integration_guide.md)
- 🔧 创建自己的工作流
- 📊 集成到你的业务流程
- 🚀 探索更多高级功能

## 技术支持

遇到问题？请检查：
1. 环境变量配置是否正确
2. n8n 服务是否正常运行
3. API 密钥是否有效
4. 网络连接是否正常

运行测试脚本获取详细诊断信息：
```bash
python scripts/test_n8n_integration.py
```

