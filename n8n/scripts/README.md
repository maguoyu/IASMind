# n8n èˆªæ²¹é‡‡è´­åˆåŒå®¡æŸ¥å·¥ä½œæµ - Python è„šæœ¬

è¿™ä¸ªç›®å½•åŒ…å«äº†å·¥ä½œæµä¸­ä½¿ç”¨çš„ä¸‰ä¸ª Python å·¥å…·è„šæœ¬ã€‚

## ğŸ“ æ–‡ä»¶åˆ—è¡¨

### 1. contract_risk_assessment.py
**åˆåŒé£é™©è¯„ä¼°å·¥å…·**
- è¯„ä¼°5ç±»é£é™©ï¼šä»·æ ¼ã€ä¾›åº”ã€è´¨é‡ã€æ³•å¾‹ã€è´¢åŠ¡
- è¾“å‡ºé‡åŒ–é£é™©è¯„åˆ†ï¼ˆ0-100ï¼‰

### 2. compliance_checker.py
**èˆªæ²¹é‡‡è´­åˆè§„æ£€æŸ¥å·¥å…·**
- æ£€æŸ¥æ°‘èˆªæ³•è§„ã€å®‰å…¨ã€ç¯ä¿ç­‰åˆè§„æ€§
- è¾“å‡ºåˆè§„æ€§æŠ¥å‘Šå’Œå»ºè®®

### 3. terms_extractor.py
**åˆåŒæ¡æ¬¾æå–å·¥å…·**
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å…³é”®æ¡æ¬¾
- è¾“å‡ºç»“æ„åŒ–çš„åˆåŒä¿¡æ¯

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šåœ¨ n8n ä¸­ç›´æ¥ä½¿ç”¨ï¼ˆæ¨èï¼‰

1. åœ¨ n8n ä¸­å¯¼å…¥ `aviation-fuel-contract-review.json`
2. Python ä»£ç å·²ç»åµŒå…¥åœ¨å·¥ä½œæµä¸­
3. ç›´æ¥æ¿€æ´»å·¥ä½œæµå³å¯ä½¿ç”¨

### æ–¹æ³•2ï¼šä»ç‹¬ç«‹æ–‡ä»¶å¤åˆ¶ä»£ç 

å¦‚æœéœ€è¦ä¿®æ”¹ä»£ç ï¼š

1. **ç¼–è¾‘ Python æ–‡ä»¶**
   ```bash
   cd /home/magy/IASMind/n8n/scripts
   vim contract_risk_assessment.py  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
   ```

2. **å¤åˆ¶åˆ° n8n**
   - æ‰“å¼€ n8n å·¥ä½œæµ
   - æ‰¾åˆ°å¯¹åº”çš„ Code Tool èŠ‚ç‚¹
   - å¤åˆ¶æ•´ä¸ª Python æ–‡ä»¶å†…å®¹
   - ç²˜è´´åˆ°èŠ‚ç‚¹çš„ä»£ç ç¼–è¾‘å™¨ä¸­

3. **ä¿å­˜å¹¶æµ‹è¯•**

## ğŸ“‹ ä»£ç è¯´æ˜

### n8n ç‰¹æ®Šè¯­æ³•

åœ¨è¿™äº›è„šæœ¬ä¸­ï¼Œä»¥ä¸‹æ˜¯ n8n ç‰¹æœ‰çš„è¯­æ³•ï¼ˆ**å·²ä¿®å¤ä¸ºæ­£ç¡®çš„ Python è¯­æ³•**ï¼‰ï¼š

```python
# è·å–è¾“å…¥æ•°æ®ï¼ˆn8n Python Code Tool æ­£ç¡®è¯­æ³•ï¼‰
for item in _input.all():
    contract_text = item.get('contractText', '')
    contract_amount = item.get('contractAmount', 0)
    
    result = assess_contract_risks(contract_text, contract_amount)
    # è¿”å›ç»“æœç»™ n8n
    _result = {'riskAssessment': result}
```

âš ï¸ **é‡è¦è¯´æ˜**:
- `_input.all()` - è·å–æ‰€æœ‰è¾“å…¥é¡¹ï¼ˆæ³¨æ„æ˜¯ä¸‹åˆ’çº¿å¼€å¤´ï¼‰
- `item.get('key', default)` - ä»è¾“å…¥é¡¹è·å–æ•°æ®
- `_result = {...}` - è®¾ç½®è¾“å‡ºç»“æœï¼ˆæ³¨æ„æ˜¯ä¸‹åˆ’çº¿å¼€å¤´ï¼‰
- âŒ **ä¸è¦ä½¿ç”¨** JavaScript è¯­æ³•å¦‚ `$input.first().json.get()`
- âœ… **AI Agent Tool ä¸“ç”¨æ ¼å¼**: `_result = {"response": json.dumps(data)}`
- è¿™äº›æ–‡ä»¶åªèƒ½åœ¨ n8n çš„ Code Tool èŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼Œä¸èƒ½ç›´æ¥åœ¨æ ‡å‡† Python ç¯å¢ƒè¿è¡Œ

## ğŸ§ª æœ¬åœ°æµ‹è¯•

å¦‚æœæƒ³åœ¨æœ¬åœ°æµ‹è¯•é€»è¾‘ï¼ˆä¸åŒ…å« n8n è¯­æ³•ï¼‰ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºï¼š

```python
# æµ‹è¯•ç”¨çš„æ ‡å‡† Python ä»£ç 
if __name__ == "__main__":
    test_contract = "èˆªæ²¹é‡‡è´­åˆåŒï¼Œé‡‡è´­æ•°é‡5000å¨ï¼Œå•ä»·8500å…ƒ/å¨"
    test_amount = 42500000
    
    result = assess_contract_risks(test_contract, test_amount)
    print(result)
```

## ğŸ”§ n8n Python vs JavaScript è¯­æ³•å¯¹ç…§

| æ“ä½œ | âŒ JavaScript è¯­æ³•ï¼ˆé”™è¯¯ï¼‰ | âœ… Python è¯­æ³•ï¼ˆæ­£ç¡®ï¼‰ |
|------|--------------------------|----------------------|
| è·å–è¾“å…¥ | `$input.first()` | `_input.all()` |
| è®¿é—®æ•°æ® | `$json.body.field` | `item.get('field')` |
| è¿”å›ç»“æœï¼ˆæ™®é€šï¼‰ | `return {'json': data}` | `_result = data` |
| è¿”å›ç»“æœï¼ˆAI Agentï¼‰ | - | `_result = {"response": json.dumps(data)}` |
| å¾ªç¯è¾“å…¥ | `$input.all()` | `for item in _input.all():` |

## ğŸ¯ AI Agent Tool è¾“å‡ºæ ¼å¼ï¼ˆé‡è¦ï¼ï¼‰

è¿™ä¸‰ä¸ªå·¥å…·æ˜¯ä¸º **AI Agent** è®¾è®¡çš„ï¼Œå¿…é¡»ä½¿ç”¨ç‰¹å®šçš„è¾“å‡ºæ ¼å¼ï¼š

```python
# âœ… æ­£ç¡®çš„ AI Agent Tool è¾“å‡ºæ ¼å¼
for item in _input.all():
    result = my_function(...)  # å‡½æ•°è¿”å›å­—å…¸å¯¹è±¡
    
    # åŒ…è£…æˆ AI Agent å¯ä»¥ç†è§£çš„æ ¼å¼
    _result = {
        "response": json.dumps(result, ensure_ascii=False, indent=2)
    }
```

**ä¸ºä»€ä¹ˆè¿™æ ·ï¼Ÿ**
- AI Agent éœ€è¦è¯»å–å·¥å…·çš„æ‰§è¡Œç»“æœ
- `response` å­—æ®µåŒ…å«å­—ç¬¦ä¸²å½¢å¼çš„ç»“æœ
- `json.dumps()` å°†å­—å…¸è½¬æ¢ä¸ºæ ¼å¼åŒ–çš„ JSON å­—ç¬¦ä¸²
- AI å¯ä»¥ç†è§£å’Œè§£æè¿™ä¸ªå­—ç¬¦ä¸²

**è¯¦ç»†è¯´æ˜**: æŸ¥çœ‹ `AI_Agent_Toolè¾“å‡ºæ ¼å¼è¯´æ˜.md`

## ğŸ”„ ä» JSON å¯¼å…¥åˆ° n8n

**æ­£ç¡®çš„å¯¼å…¥æµç¨‹ï¼š**

1. æ‰“å¼€ n8n Web ç•Œé¢
2. ç‚¹å‡»å³ä¸Šè§’ **"èœå•"** â†’ **"Import from File"**
3. é€‰æ‹© `/home/magy/IASMind/n8n/workflow/aviation-fuel-contract-review.json`
4. ç‚¹å‡» **"Import"**
5. n8n ä¼šè‡ªåŠ¨è§£æ JSON ä¸­çš„è½¬ä¹‰å­—ç¬¦ï¼Œè¿˜åŸå¤šè¡Œä»£ç 

**âŒ ä¸è¦è¿™æ ·åšï¼š**
- ä¸è¦ç›´æ¥å¤åˆ¶ JSON æ–‡æœ¬åˆ°èŠ‚ç‚¹
- ä¸è¦æ‰‹åŠ¨ç¼–è¾‘ JSON ä¸­çš„ `\n` è½¬ä¹‰å­—ç¬¦
- ä¸è¦ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ JSON åå†ç²˜è´´

## ğŸ“Š JSON ä¸­çš„ä»£ç æ ¼å¼

åœ¨ JSON æ–‡ä»¶ä¸­ï¼ŒPython ä»£ç æ˜¯è¿™æ ·å­˜å‚¨çš„ï¼š

```json
{
  "parameters": {
    "name": "ContractRiskAssessment",
    "code": "# åˆåŒé£é™©è¯„ä¼°å·¥å…·\nimport json\nimport re\n\ndef assess_contract_risks..."
  }
}
```

è¿™æ˜¯æ­£å¸¸çš„ JSON æ ¼å¼ï¼š
- `\n` ä»£è¡¨æ¢è¡Œç¬¦
- `\"` ä»£è¡¨åŒå¼•å·
- ä»£ç è¢«å‹ç¼©æˆä¸€è¡Œ

å½“é€šè¿‡ n8n UI å¯¼å…¥æ—¶ï¼Œä¼šè‡ªåŠ¨è§£ææˆå¤šè¡Œæ ¼å¼ï¼

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæˆ‘å¤åˆ¶ JSON åä»£ç ä¸¢å¤±äº†ï¼Ÿ
**A**: ä½ å¯èƒ½ç›´æ¥å¤åˆ¶äº† JSON æ–‡æœ¬ã€‚æ­£ç¡®æ–¹æ³•æ˜¯ä½¿ç”¨ n8n çš„ "Import from File" åŠŸèƒ½ã€‚

### Q: å¦‚ä½•ä¿®æ”¹ä»£ç ï¼Ÿ
**A**: 
1. åœ¨ n8n ä¸­å¯¼å…¥å·¥ä½œæµ
2. åŒå‡»å¯¹åº”çš„ Code Tool èŠ‚ç‚¹
3. ç›´æ¥åœ¨ä»£ç ç¼–è¾‘å™¨ä¸­ä¿®æ”¹
4. æˆ–è€…ä¿®æ”¹è¿™é‡Œçš„ .py æ–‡ä»¶ï¼Œç„¶åå¤åˆ¶åˆ° n8n

### Q: ä»£ç å¯ä»¥åœ¨ IDE ä¸­ç¼–è¾‘å—ï¼Ÿ
**A**: å¯ä»¥ï¼ä½ å¯ä»¥åœ¨ IDE ä¸­ç¼–è¾‘è¿™äº› .py æ–‡ä»¶ï¼Œä½†è¦æ³¨æ„ n8n çš„ç‰¹æ®Šè¯­æ³•ï¼ˆ`$input` ç­‰ï¼‰ã€‚

## ğŸ“š ç›¸å…³èµ„æº

- [n8n å®˜æ–¹æ–‡æ¡£](https://docs.n8n.io/)
- [n8n Code Node æ–‡æ¡£](https://docs.n8n.io/code/builtin/code-node/)
- [å·¥ä½œæµ JSON ä½ç½®](../workflow/aviation-fuel-contract-review.json)

